# FINOS Waltz Charm Publishing Job

After a Pull Request merged, the ``Publish Charm`` [Github action](../.github/workflows/publish.yaml) will run, which will build the charm and publish it to Charmhub on the edge channel. This action requires the ``CHARMHUB_TOKEN`` repository secret (Settings > Secrets > Actions > New repository secret) to be set up in the project in order to push the new charm revision. The token can be generated by running:

```bash
charmcraft login --export=secrets-waltz.auth --charm=finos-waltz-k8s \
      --permission=package-manage --permission=package-view-revisions \
      --channel=edge --ttl=7948800
```

This token will have to be updated periodically since it has a certain time to live set. If the `charmcraft` process fails with the message "Provided credentials are no longer valid for Charmhub. Regenerate them and try again.", it means you have to export the secrets again by logging in to charmcraft using the instructions written above.

By using the following `gh` command you can skip going through the repository settings to set the secret token:

```bash
gh -R finos/waltz-integration-juju secret set CHARMHUB_TOKEN < secrets-waltz.auth
```
